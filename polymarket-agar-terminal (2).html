<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>POLYAGAR Â· BLACK-SCHOLES BINARY Â· TERMINAL</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Orbitron:wght@400;700;900&display=swap');

:root {
  --bg:     #080a0c;
  --bg2:    #0c0f12;
  --panel:  #0d1117;
  --panel2: #111820;
  --border: #1a2535;
  --border2:#243040;
  --dim:    #1e2d3d;
  --text:   #7a9ab8;
  --bright: #b8d0e8;
  --white:  #d8eaf8;
  --green:  #00ff88;
  --green2: #00cc66;
  --green3: #004422;
  --red:    #ff3355;
  --red2:   #cc2244;
  --cyan:   #00e5ff;
  --cyan2:  #0099bb;
  --gold:   #ffd060;
  --gold2:  #cc9900;
  --purple: #aa55ff;
  --orange: #ff8833;
  /* grid lines like screenshot 2 */
  --grid:   rgba(0,229,255,0.04);
}

*{margin:0;padding:0;box-sizing:border-box;}
html,body{height:100%;overflow:hidden;}

body {
  background: var(--bg);
  font-family: 'Share Tech Mono', monospace;
  color: var(--text);
  cursor: default;
  /* Subtle scanlines */
  background-image: repeating-linear-gradient(
    0deg, transparent, transparent 3px,
    rgba(0,229,255,0.012) 3px, rgba(0,229,255,0.012) 4px
  );
}

/* â”€â”€ CRT vignette â”€â”€ */
body::after {
  content:'';position:fixed;inset:0;
  background: radial-gradient(ellipse at center, transparent 50%, rgba(0,0,0,0.7) 100%);
  pointer-events:none;z-index:9999;
}

/* â”€â”€ TOPBAR â”€â”€ */
#topbar {
  position:fixed;top:0;left:0;right:0;height:32px;
  background: var(--panel);
  border-bottom: 1px solid var(--border2);
  display:flex;align-items:center;
  z-index:500;font-size:10px;
  box-shadow: 0 1px 20px rgba(0,229,255,0.06);
}
.brand {
  font-family:'Orbitron',monospace;font-weight:900;font-size:11px;
  color:var(--white);letter-spacing:2px;
  padding:0 14px;border-right:1px solid var(--border2);
  height:100%;display:flex;align-items:center;
  text-shadow:0 0 12px rgba(0,229,255,0.5);
}
.brand em{color:var(--cyan);font-style:normal;}
.ts{
  padding:0 10px;height:100%;display:flex;align-items:center;gap:5px;
  border-right:1px solid var(--border);font-size:9px;color:var(--text);
  white-space:nowrap;
}
.ts b{font-weight:normal;color:var(--bright);}
.ts b.g{color:var(--green);}
.ts b.c{color:var(--cyan);}
.ts b.gold{color:var(--gold);}
.ts b.r{color:var(--red);}
.ts b.p{color:var(--purple);}
.tsp{flex:1;}
.live-seg{
  padding:0 12px;display:flex;align-items:center;gap:6px;
  font-size:9px;color:var(--green);letter-spacing:1px;
}
.ldot{width:5px;height:5px;border-radius:50%;background:var(--green);
  animation:ldot 1.2s infinite;box-shadow:0 0 6px var(--green);}
@keyframes ldot{0%,100%{opacity:1;box-shadow:0 0 6px var(--green)}50%{opacity:0.2;box-shadow:none}}

/* â”€â”€ LAYOUT â”€â”€
   3 cols Ã— 3 rows
   rows: [chart 200px] [game flex] [log 100px]
   cols: [left 186px] [center 1fr] [right 210px]
*/
#layout {
  position:fixed;top:32px;left:0;right:0;bottom:0;
  display:grid;
  grid-template-columns: 186px 1fr 210px;
  grid-template-rows: 200px 1fr 100px;
}

/* panels */
#left   {grid-row:1/4;grid-column:1;background:var(--panel);border-right:1px solid var(--border2);display:flex;flex-direction:column;overflow:hidden;}
#top-c  {grid-row:1;grid-column:2;background:var(--panel2);border-bottom:1px solid var(--border2);padding:7px 12px 5px;display:flex;flex-direction:column;}
#game-w {grid-row:2;grid-column:2;position:relative;overflow:hidden;background:var(--bg2);cursor:none;}
#bot-c  {grid-row:3;grid-column:2;background:var(--panel);border-top:1px solid var(--border2);padding:6px 12px;overflow:hidden;}
#right  {grid-row:1/4;grid-column:3;background:var(--panel);border-left:1px solid var(--border2);display:flex;flex-direction:column;overflow:hidden;}

#game-cv{position:absolute;inset:0;width:100%;height:100%;}

/* â”€â”€ SECTION â”€â”€ */
.sec{padding:8px 10px;border-bottom:1px solid var(--border);}
.sh{
  font-family:'Orbitron',monospace;font-size:7px;
  letter-spacing:2px;color:var(--border2);
  border-bottom:1px solid var(--border);
  padding-bottom:3px;margin-bottom:5px;
  text-transform:uppercase;
}
.sh em{color:var(--cyan2);font-style:normal;}

/* â”€â”€ STAT ROW â”€â”€ */
.sr{display:flex;justify-content:space-between;align-items:baseline;padding:1.5px 0;}
.sl{font-size:8.5px;color:var(--text);}
.sv{font-family:'Orbitron',monospace;font-size:12px;color:var(--bright);}
.sv.g {color:var(--green);text-shadow:0 0 8px rgba(0,255,136,0.4);}
.sv.r {color:var(--red);}
.sv.c {color:var(--cyan);text-shadow:0 0 8px rgba(0,229,255,0.3);}
.sv.gold{color:var(--gold);text-shadow:0 0 8px rgba(255,208,96,0.3);}
.sv.p {color:var(--purple);}
.sv.xl{font-size:19px;}

/* â”€â”€ MARKET ROWS â”€â”€ */
.mi{display:grid;grid-template-columns:1fr 26px 26px 38px;gap:2px;align-items:center;padding:2px 4px;font-size:8.5px;cursor:pointer;border:1px solid transparent;border-radius:2px;transition:all 0.08s;}
.mi:hover,.mi.act{background:var(--dim);border-color:var(--border2);}
.mn{color:var(--bright);font-size:8.5px;}
.my{color:var(--green);text-align:right;}
.mno{color:var(--red);text-align:right;}
.me{font-size:8px;text-align:right;}
.me.pos{color:var(--green);}
.me.neg{color:var(--red);}

/* â”€â”€ FORMULA â”€â”€ */
.fb{font-size:8.5px;color:var(--text);line-height:1.95;background:var(--dim);border:1px solid var(--border);border-radius:2px;padding:6px 8px;}
.fb .fk{color:var(--cyan);}
.fb .fv{color:var(--white);font-family:'Orbitron',monospace;font-size:10px;}

/* â”€â”€ PROGRESS BARS â”€â”€ */
.pb{height:4px;background:var(--dim);border-radius:2px;overflow:hidden;margin-top:2px;}
.pbf{height:100%;border-radius:2px;transition:width 0.3s;}
.pbf.hp  {background:linear-gradient(90deg,var(--green),#00ff44);}
.pbf.rnd {background:linear-gradient(90deg,var(--cyan),var(--purple));}
.pbf.acc {background:linear-gradient(90deg,var(--gold),var(--green));}

/* â”€â”€ POSITION CARDS â”€â”€ */
.pc{border-radius:2px;padding:4px 6px;font-size:8.5px;margin-bottom:3px;border-left:2px solid var(--border2);}
.pc.win {border-left-color:var(--green);background:rgba(0,255,136,0.04);}
.pc.loss{border-left-color:var(--red);background:rgba(255,51,85,0.04);}
.pc-h{display:flex;justify-content:space-between;margin-bottom:2px;}
.pc-m{font-size:8.5px;color:var(--bright);}
.pc-p{font-family:'Orbitron',monospace;font-size:10px;}
.pc-p.pos{color:var(--green);}
.pc-p.neg{color:var(--red);}
.pc-bar{height:2px;background:var(--dim);border-radius:1px;overflow:hidden;}
.pc-bf{height:100%;border-radius:1px;transition:width 0.4s;}
.pc-bf.pos{background:var(--green2);}
.pc-bf.neg{background:var(--red2);}
.pc-meta{display:flex;justify-content:space-between;margin-top:2px;color:var(--text);font-size:7.5px;}

/* â”€â”€ LOG â”€â”€ */
.ll{display:flex;gap:6px;font-size:8.5px;line-height:1.85;animation:lin 0.12s ease;}
@keyframes lin{from{opacity:0;transform:translateX(-3px)}to{opacity:1}}
.lt{color:var(--text);min-width:50px;}
.la{font-weight:bold;min-width:42px;}
.la.eat{color:var(--green);}
.la.win{color:var(--cyan);}
.la.food{color:var(--gold);}
.la.skip{color:var(--border2);}
.lm{color:var(--cyan);min-width:74px;}
.le{color:var(--text);}
.lp{font-family:'Orbitron',monospace;font-size:8.5px;}
.lp.pos{color:var(--green);}
.lp.neg{color:var(--red);}

/* â”€â”€ CHART AREA â”€â”€ */
#chart-hdr{display:flex;justify-content:space-between;align-items:center;margin-bottom:5px;}
#pnl-cv{display:block;border-radius:2px;border:1px solid var(--border);}

/* â”€â”€ GAME HUD â”€â”€ */
.hpill{
  position:absolute;pointer-events:none;z-index:10;
  background:rgba(13,17,23,0.88);border:1px solid var(--border2);
  border-radius:2px;padding:3px 10px;
  font-family:'Orbitron',monospace;font-size:9px;font-weight:700;
  color:var(--bright);backdrop-filter:blur(4px);letter-spacing:1px;
  box-shadow:0 0 12px rgba(0,229,255,0.08);
}
#hud-score{top:8px;right:8px;color:var(--gold);}
#hud-combo{bottom:8px;left:8px;display:none;color:var(--orange);}
#hud-timer{bottom:8px;right:8px;color:var(--cyan);}

/* â”€â”€ SIM BTN â”€â”€ */
#sim-btn{
  position:absolute;top:8px;left:8px;z-index:10;
  font-family:'Orbitron',monospace;font-size:8px;font-weight:700;
  padding:4px 10px;border-radius:2px;cursor:pointer;
  border:1px solid var(--border2);background:var(--panel);
  color:var(--text);letter-spacing:2px;text-transform:uppercase;transition:all 0.12s;
  pointer-events:all;
}
#sim-btn.on{
  border-color:var(--green);color:var(--green);
  text-shadow:0 0 8px var(--green);
  background:rgba(0,255,136,0.05);
  box-shadow:0 0 12px rgba(0,255,136,0.12);
}

/* â”€â”€ EPIC PROFIT POPUPS â”€â”€ */
.pop{position:absolute;pointer-events:none;z-index:100;transform:translate(-50%,-50%);font-family:'Orbitron',monospace;font-weight:900;white-space:nowrap;}
.pop.big{animation:popBig 1.2s cubic-bezier(0.1,0,0.3,1) forwards;}
.pop.food{animation:popFood 0.7s ease-out forwards;}
@keyframes popBig{
  0%  {opacity:0;font-size:0px;filter:blur(8px);letter-spacing:0px;}
  12% {opacity:1;font-size:30px;filter:blur(0);letter-spacing:3px;}
  40% {opacity:1;font-size:34px;transform:translate(-50%,-50%) scale(1.06);}
  65% {opacity:1;font-size:30px;transform:translate(-50%,-70px);}
  100%{opacity:0;font-size:26px;transform:translate(-50%,-130px) scale(0.85);}
}
@keyframes popFood{
  0%  {opacity:0;font-size:0px;}
  20% {opacity:1;font-size:13px;}
  70% {opacity:1;transform:translate(-50%,-45px);}
  100%{opacity:0;transform:translate(-50%,-75px);}
}

/* â”€â”€ PARTICLE â”€â”€ */
.pt{position:absolute;pointer-events:none;z-index:99;border-radius:50%;transform:translate(-50%,-50%);}

/* â”€â”€ OVERLAY â”€â”€ */
#overlay{
  position:absolute;inset:0;
  background:rgba(8,10,12,0.95);
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  z-index:50;
}
.ov-logo{font-family:'Orbitron',monospace;font-weight:900;font-size:32px;color:var(--white);letter-spacing:4px;margin-bottom:4px;text-shadow:0 0 20px rgba(0,229,255,0.4);}
.ov-logo em{color:var(--cyan);font-style:normal;}
.ov-sub{font-size:9px;color:var(--text);letter-spacing:3px;margin-bottom:20px;}
.ov-box{font-size:9px;color:var(--bright);text-align:center;line-height:2.2;background:var(--panel2);border:1px solid var(--border2);border-radius:2px;padding:12px 20px;margin-bottom:18px;max-width:380px;}
.ov-box .g{color:var(--green);}
.ov-box .r{color:var(--red);}
.ov-box .c{color:var(--cyan);}
.ov-btns{display:flex;gap:10px;}
.ovb{font-family:'Orbitron',monospace;font-weight:700;font-size:10px;letter-spacing:2px;padding:9px 22px;border-radius:2px;cursor:pointer;transition:all 0.12s;text-transform:uppercase;}
.ovb.p{background:var(--white);color:var(--bg);border:none;}
.ovb.p:hover{background:var(--green);box-shadow:0 0 16px rgba(0,255,136,0.4);}
.ovb.s{background:transparent;color:var(--green);border:1px solid var(--green);}
.ovb.s:hover{background:var(--green);color:var(--bg);box-shadow:0 0 16px rgba(0,255,136,0.4);}

#grade-el{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-family:'Orbitron',monospace;font-weight:900;font-size:110px;opacity:0;pointer-events:none;z-index:30;transition:opacity 0.3s;}

/* â”€â”€ FLASH â”€â”€ */
#flash{position:fixed;inset:0;pointer-events:none;z-index:8000;opacity:0;transition:opacity 0.06s;}

/* â”€â”€ BLINK/GLOW ANIMS â”€â”€ */
.glow-g{animation:glowG 2s infinite;}
.glow-c{animation:glowC 2.5s infinite;}
.glow-gold{animation:glowGold 2.2s infinite;}
@keyframes glowG{0%,100%{text-shadow:0 0 6px rgba(0,255,136,0.4)}50%{text-shadow:0 0 14px rgba(0,255,136,0.8),0 0 30px rgba(0,255,136,0.3)}}
@keyframes glowC{0%,100%{text-shadow:0 0 6px rgba(0,229,255,0.3)}60%{text-shadow:0 0 14px rgba(0,229,255,0.8)}}
@keyframes glowGold{0%,100%{text-shadow:0 0 6px rgba(255,208,96,0.3)}55%{text-shadow:0 0 14px rgba(255,208,96,0.8)}}

/* â”€â”€ STAT PULSE â”€â”€ */
@keyframes sPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.08)}}
.spulse{animation:sPulse 0.3s ease;}

/* shake win only - subtle */
@keyframes shakeW{0%,100%{transform:none}30%{transform:translate(1px,-1px)}70%{transform:translate(-1px,1px)}}

::-webkit-scrollbar{width:2px;}
::-webkit-scrollbar-track{background:var(--bg);}
::-webkit-scrollbar-thumb{background:var(--border2);}
</style>
</head>
<body>
<div id="flash"></div>

<!-- TOPBAR -->
<div id="topbar">
  <div class="brand">POLY<em>AGAR</em>&thinsp;Â·&thinsp;TERMINAL</div>
  <div class="ts">model: <b>BLACK-SCHOLES BINARY</b></div>
  <div class="ts">markets: <b class="c">SPORTS Â· CRYPTO Â· 5MIN</b></div>
  <div class="ts">MC_paths: <b>200,000</b></div>
  <div class="ts">kelly: <b class="g" id="t-kelly">0.25x</b></div>
  <div class="ts">edge_thresh: <b>3%</b></div>
  <div class="ts">balance: <b class="g glow-g" id="t-bal">$1,000</b></div>
  <div class="ts">P&L: <b class="g" id="t-pnl">+$0</b></div>
  <div class="ts">combo: <b class="gold" id="t-combo">0Ã—</b></div>
  <div class="ts">win_rate: <b class="c glow-c" id="t-wr">â€”</b></div>
  <div class="tsp"></div>
  <div class="live-seg"><div class="ldot"></div>LIVE Â· 5MIN Â· CLOB</div>
</div>

<div id="layout">

<!-- LEFT -->
<div id="left">
  <div class="sec">
    <div class="sh">// <em>market watch</em> Â· polymarket clob</div>
    <div style="display:grid;grid-template-columns:1fr 24px 24px 36px;gap:1px;font-size:7.5px;color:var(--text);padding:0 4px;margin-bottom:3px;">
      <span>MARKET</span><span style="text-align:right">YES</span><span style="text-align:right">NO</span><span style="text-align:right">EDGE</span>
    </div>
    <div id="mkt-list"></div>
  </div>

  <div class="sec">
    <div class="sh">// <em>black-scholes</em> Â· jump-diffusion</div>
    <div class="fb">
      C = e<sup style="font-size:7px">-rT</sup>Â·N(dâ‚‚)<br>
      x_t = logit(p_t) + ln(p/(1-p))<br>
      dx = Î¼Â·dt + Ïƒ_bÂ·dW + [ÎµÂ·N(dt,da)]<br>
      <span class="fk">dâ‚‚   </span><span class="fv" id="bs-d2">0.0012</span><br>
      <span class="fk">N(dâ‚‚) </span><span class="fv" id="bs-nd2">0.50014</span><br>
      <span class="fk">Ïƒ    </span><span class="fv" id="bs-vol">0.353</span> <span style="font-size:7px;color:var(--text)">ann.IV</span><br>
      <span class="fk">Î»    </span><span class="fv" id="bs-lam">2.97</span> <span style="font-size:7px;color:var(--text)">jump</span>
    </div>
  </div>

  <div class="sec">
    <div class="sh">// <em>edge detection</em> pipeline</div>
    <div class="sr"><span class="sl">model_fair</span><span class="sv c" id="model-fair">50.00%</span></div>
    <div class="sr"><span class="sl">mkt_price</span><span class="sv" id="mkt-price">50.00%</span></div>
    <div class="sr"><span class="sl">divergence</span><span class="sv" id="divergence">0.00%</span></div>
    <div class="sr"><span class="sl">threshold</span><span class="sv" style="color:var(--text)">3.00%</span></div>
    <div class="sr"><span class="sl">kelly_f</span><span class="sv g">0.25x</span></div>
  </div>

  <div class="sec" style="margin-top:auto;">
    <div class="sh">// <em>health</em> Â· round progress</div>
    <div style="display:flex;justify-content:space-between;font-size:8px;margin-bottom:2px">
      <span style="color:var(--text)">HP</span><span class="sv g glow-g" id="hp-val" style="font-size:11px">100</span>
    </div>
    <div class="pb"><div class="pbf hp" id="hp-fill" style="width:100%"></div></div>
    <div style="display:flex;justify-content:space-between;font-size:8px;margin:5px 0 2px">
      <span style="color:var(--text)">ROUND</span><span class="sv c" id="round-val" style="font-size:10px">0/20</span>
    </div>
    <div class="pb"><div class="pbf rnd" id="round-fill" style="width:0%"></div></div>
  </div>

  <div class="sec">
    <div class="sh">// <em>scan feed</em></div>
    <div id="live-feed" style="font-size:8px;line-height:1.85;color:var(--text);max-height:64px;overflow:hidden"></div>
  </div>
</div>

<!-- TOP CENTER: GIANT CHART -->
<div id="top-c">
  <div id="chart-hdr">
    <div style="display:flex;align-items:center;gap:10px">
      <span style="font-family:'Orbitron',monospace;font-size:7px;text-transform:uppercase;letter-spacing:2px;color:var(--text)">// portfolio growth Â· p&l curve Â· $1,000 â†’</span>
      <span class="sv xl g glow-g" id="chart-bal">$1,000</span>
    </div>
    <div style="display:flex;gap:14px;font-size:8.5px;color:var(--text)">
      <span>win_rate <b id="chart-wr" class="sv gold glow-gold" style="font-size:11px">â€”</b></span>
      <span>trades <b id="chart-tr" class="sv c" style="font-size:10px">0</b></span>
      <span>avg_pt <b id="chart-apt" class="sv g" style="font-size:10px">â€”</b></span>
      <span>max_dd <b id="chart-dd" class="sv r" style="font-size:10px">0%</b></span>
      <span>P&L <b id="chart-pnl" class="sv g glow-g" style="font-size:10px">+$0</b></span>
    </div>
  </div>
  <canvas id="pnl-cv"></canvas>
</div>

<!-- GAME -->
<div id="game-w">
  <canvas id="game-cv"></canvas>
  <div class="hpill" id="hud-score">SCORE: <span id="score-val">0</span></div>
  <div class="hpill" id="hud-combo">ğŸ”¥ <span id="combo-val">0</span>Ã— COMBO</div>
  <div class="hpill" id="hud-timer">â± <span id="timer-val">5:00</span></div>
  <button id="sim-btn" onclick="toggleSim()">â¬› AUTO SIM</button>
  <div id="grade-el"></div>
  <div id="overlay">
    <div class="ov-logo">POLY<em>AGAR</em></div>
    <div class="ov-sub">BLACK-SCHOLES BINARY Â· POLYMARKET CLOB Â· 5MIN</div>
    <div class="ov-box">
      You are a <span class="g">market maker blob</span> â€” grow by eating alpha, shrink when rekt<br>
      <span class="g">Green blobs</span> = positive edge â†’ eat = Kelly bet profit<br>
      <span class="r">Red blobs</span> = hostile rivals â†’ eat if smaller, flee if bigger<br>
      <span class="c">Cyan pellets</span> = free alpha, instant small profit
    </div>
    <div class="ov-btns">
      <button class="ovb p" onclick="startGame(false)">â–¶ PLAY</button>
      <button class="ovb s" onclick="startGame(true)">âš¡ AUTO SIM</button>
    </div>
  </div>
</div>

<!-- BOT LOG -->
<div id="bot-c">
  <div style="font-family:'Orbitron',monospace;font-size:7px;text-transform:uppercase;letter-spacing:2px;color:var(--text);margin-bottom:4px;">// execution log Â· edge capture Â· kelly orders</div>
  <div id="log-c"></div>
</div>

<!-- RIGHT -->
<div id="right">
  <div class="sec">
    <div class="sh">// <em>live performance</em></div>
    <div class="sr"><span class="sl">balance</span><span class="sv xl g glow-g" id="r-bal">$1,000</span></div>
    <div class="sr"><span class="sl">total P&L</span><span class="sv xl" id="r-pnl" style="color:var(--green)">+$0</span></div>
    <div class="sr"><span class="sl">win rate</span><span class="sv gold glow-gold" id="r-wr">â€”</span></div>
    <div class="sr"><span class="sl">trades</span><span class="sv c" id="r-tr">0</span></div>
    <div class="sr"><span class="sl">avg P/trade</span><span class="sv g" id="r-apt">â€”</span></div>
  </div>
  <div class="sec">
    <div class="sh">// <em>game stats</em></div>
    <div class="sr"><span class="sl">score</span><span class="sv gold" id="r-sc">0</span></div>
    <div class="sr"><span class="sl">max combo</span><span class="sv p" id="r-mc">0Ã—</span></div>
    <div class="sr"><span class="sl">cells eaten</span><span class="sv g glow-g" id="r-eaten">0</span></div>
    <div class="sr"><span class="sl">times rekt</span><span class="sv r" id="r-rekt">0</span></div>
    <div class="sr"><span class="sl">blob size</span><span class="sv c" id="r-size">â€”</span></div>
  </div>
  <div class="sec">
    <div class="sh">// <em>accuracy</em></div>
    <div style="display:flex;justify-content:space-between;font-size:8px;margin-bottom:2px">
      <span style="color:var(--text)">EDGE HIT RATE</span>
      <span class="sv gold glow-gold" id="acc-v" style="font-size:10px">â€”</span>
    </div>
    <div class="pb"><div class="pbf acc" id="acc-f" style="width:0%"></div></div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:3px;margin-top:5px;font-size:8px">
      <div style="color:var(--green)">EATEN: <span id="h-eat" style="font-family:'Orbitron',monospace;font-weight:700">0</span></div>
      <div style="color:var(--red)">REKT: <span id="h-rekt" style="font-family:'Orbitron',monospace;font-weight:700">0</span></div>
      <div style="color:var(--cyan)">FOOD: <span id="h-food" style="font-family:'Orbitron',monospace;font-weight:700">0</span></div>
      <div style="color:var(--gold)">COMBOÃ—: <span id="h-combo" style="font-family:'Orbitron',monospace;font-weight:700">0</span></div>
    </div>
  </div>
  <div class="sec" style="flex:1;overflow:hidden">
    <div class="sh">// <em>open positions</em></div>
    <div id="pos-list" style="overflow-y:auto;max-height:200px"></div>
  </div>
</div>

</div><!-- layout -->

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GLOBALS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const G = {
  running:false, autoSim:false,
  score:0, combo:0, maxCombo:0,
  hp:100, balance:1000, start$:1000, pnl:0,
  wins:0, losses:0, trades:0,
  eaten:0, rekt:0, foodEaten:0,
  pnlHist:[1000], maxBal:1000,
  positions:[], logLines:[], feedLines:[],
  roundTimer:300, timerInt:null,
  nid:0, btcPrice:62462,
  btcGo:false, feedGo:false,
  player:null, blobs:[], food:[],
  // smooth camera
  camX:0, camY:0,
  mouseX:0, mouseY:0,
  WORLD:1600,
  // physics
  accum:0,
};

const MKTS=[
  {n:'BTC UP',y:50},{n:'ETH UP',y:48},{n:'SOL UP',y:52},{n:'XRP UP',y:45},
  {n:'LAL/BOS',y:56},{n:'ALA/ARK',y:46},{n:'FIN/SUI',y:50},
  {n:'KEN/TEN',y:41},{n:'RMA/BAR',y:60},{n:'ALC/SIN',y:47},
];
let activeMkt=MKTS[0];

const GCOLS=['#00cc66','#00aabb','#6633cc','#00cc99','#88cc00'];
const RCOLS=['#cc2244','#cc3388','#bb2233'];
const FCOLS=['#00aacc','#0066cc','#5533cc'];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CANVAS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const cv=document.getElementById('game-cv');
const ctx=cv.getContext('2d');
let VW=0,VH=0;
function resize(){const w=document.getElementById('game-w');VW=cv.width=w.clientWidth;VH=cv.height=w.clientHeight;}
resize();
window.addEventListener('resize',resize);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// WORLD FACTORY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function mkPlayer(){
  return {id:G.nid++,x:G.WORLD/2,y:G.WORLD/2,r:26,color:'#1a88ff',isPlayer:true,vx:0,vy:0};
}
function mkBlob(hostile){
  const mkt=MKTS[Math.floor(Math.random()*MKTS.length)];
  const baseR=hostile?20+Math.random()*28:12+Math.random()*24;
  const r=hostile?baseR*1.2:baseR;
  const edge=hostile?-(Math.random()*14+2):(Math.random()*16+2);
  return {
    id:G.nid++,x:rand(G.WORLD),y:rand(G.WORLD),r,hostile,
    color:hostile?pick(RCOLS):pick(GCOLS),
    mkt,edge:+edge.toFixed(1),side:Math.random()>.5?'YES':'NO',
    vx:(Math.random()-.5)*.7,vy:(Math.random()-.5)*.7,
    wA:Math.random()*Math.PI*2,wT:30+Math.random()*50,
  };
}
function mkFood(){
  return {id:G.nid++,x:rand(G.WORLD),y:rand(G.WORLD),r:3+Math.random()*4,color:pick(FCOLS),val:Math.round(Math.random()*7+2)};
}
function rand(n){return Math.random()*n;}
function pick(a){return a[Math.floor(Math.random()*a.length)];}

function initWorld(){
  G.player=mkPlayer();
  G.camX=G.player.x; G.camY=G.player.y;
  G.blobs=[];G.food=[];
  for(let i=0;i<20;i++)G.blobs.push(mkBlob(i%3===0));
  for(let i=0;i<85;i++)G.food.push(mkFood());
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INPUT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const gw=document.getElementById('game-w');
gw.addEventListener('mousemove',e=>{
  const r=cv.getBoundingClientRect();
  G.mouseX=e.clientX-r.left; G.mouseY=e.clientY-r.top;
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MAIN LOOP â€” fixed timestep
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const STEP=16;
let lastT=0;
function loop(ts){
  requestAnimationFrame(loop);
  const dt=Math.min(ts-lastT,80); lastT=ts;
  if(G.running){
    G.accum+=dt;
    while(G.accum>=STEP){ physics(STEP/16); G.accum-=STEP; }
    collide();
  }
  render();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PHYSICS â€” fixed-rate, no jitter
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function physics(dt){
  if(!G.player)return;
  const p=G.player;

  // TARGET
  let wx,wy;
  if(G.autoSim){
    const t=simTarget(); wx=t.x; wy=t.y;
  } else {
    const z=zoom(); wx=G.camX+(G.mouseX-VW/2)/z; wy=G.camY+(G.mouseY-VH/2)/z;
  }

  // Smooth velocity-based player movement
  const dx=wx-p.x, dy=wy-p.y;
  const d=Math.sqrt(dx*dx+dy*dy)||1;
  const spd=Math.max(1.2,5.2-p.r*.032);
  if(d>4){
    p.vx+=(dx/d*spd-p.vx)*.20*dt;
    p.vy+=(dy/d*spd-p.vy)*.20*dt;
  } else { p.vx*=.88; p.vy*=.88; }
  p.x+=p.vx*dt; p.y+=p.vy*dt;
  p.x=clamp(p.x,p.r,G.WORLD-p.r);
  p.y=clamp(p.y,p.r,G.WORLD-p.r);

  // SMOOTH CAMERA LERP â€” eliminates all jitter
  G.camX+=(p.x-G.camX)*.09*dt;
  G.camY+=(p.y-G.camY)*.09*dt;

  // AI blobs
  for(const b of G.blobs){
    b.wT-=dt;
    if(b.wT<=0){b.wA+=(Math.random()-.5)*2;b.wT=25+Math.random()*45;}
    if(b.hostile&&G.player&&b.r>p.r*.85){
      const ddx=p.x-b.x,ddy=p.y-b.y;
      if(Math.sqrt(ddx*ddx+ddy*ddy)<260) b.wA=Math.atan2(ddy,ddx);
    }
    const bs=Math.max(.4,3-b.r*.03);
    b.vx+=(Math.cos(b.wA)*bs-b.vx)*.14*dt;
    b.vy+=(Math.sin(b.wA)*bs-b.vy)*.14*dt;
    b.x+=b.vx*dt; b.y+=b.vy*dt;
    if(b.x<b.r||b.x>G.WORLD-b.r){b.vx*=-.9;b.wA=Math.PI-b.wA;b.x=clamp(b.x,b.r,G.WORLD-b.r);}
    if(b.y<b.r||b.y>G.WORLD-b.r){b.vy*=-.9;b.wA=-b.wA;b.y=clamp(b.y,b.r,G.WORLD-b.r);}
  }
  while(G.blobs.length<22)G.blobs.push(mkBlob(G.blobs.filter(b=>b.hostile).length<8));
  while(G.food.length<85)G.food.push(mkFood());
}

function clamp(v,a,b){return Math.max(a,Math.min(b,v));}

// AUTO-SIM: always seek profitable targets, flee danger
function simTarget(){
  const p=G.player;
  // Flee big hostiles
  for(const b of G.blobs){
    if(b.hostile&&b.r>p.r*1.05){
      const dd=dist(p,b);
      if(dd<200){
        const dx2=p.x-b.x,dy2=p.y-b.y,l=Math.sqrt(dx2*dx2+dy2*dy2)||1;
        return {x:p.x+dx2/l*220,y:p.y+dy2/l*220};
      }
    }
  }
  // Seek best food/blob
  let best=null,bs=-Infinity;
  for(const f of G.food){const sc=f.val/(dist(p,f)+1)*18;if(sc>bs){bs=sc;best={x:f.x,y:f.y};}}
  for(const b of G.blobs){
    if(b.r<p.r*.9){
      const sc=(b.edge*2.5+(p.r-b.r))/(dist(p,b)+1)*15;
      if(sc>bs){bs=sc;best={x:b.x,y:b.y};}
    }
  }
  return best||{x:G.WORLD/2,y:G.WORLD/2};
}

function zoom(){return!G.player?1:Math.max(.34,Math.min(1.1,520/(G.player.r*3+75)));}
function dist(a,b){return Math.sqrt((a.x-b.x)**2+(a.y-b.y)**2);}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// COLLISIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function collide(){
  if(!G.player)return;
  const p=G.player;
  for(let i=G.food.length-1;i>=0;i--){
    const f=G.food[i];
    if(dist(p,f)<p.r+f.r*.65){eatFood(f);G.food.splice(i,1);}
  }
  for(let i=G.blobs.length-1;i>=0;i--){
    const b=G.blobs[i];
    const d=dist(p,b);
    if(d<p.r+b.r-Math.min(p.r,b.r)*.4){
      if(p.r>b.r*1.07){eatBlob(b);G.blobs.splice(i,1);}
      else if(b.r>p.r*1.07&&!G.autoSim){rektByBlob(b);} // auto-sim avoids being eaten
    }
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TRADE EVENTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function eatFood(f){
  G.balance+=f.val; G.pnl+=f.val; G.wins++; G.trades++; G.foodEaten++;
  G.player.r=Math.min(140,G.player.r+.3);
  G.score+=8; G.pnlHist.push(G.balance); G.maxBal=Math.max(G.maxBal,G.balance);
  addLog('FOOD','ALPHA','BUY',f.val,1.5);
  updateUI(); drawChart(); updateStats();
  pop('+$'+f.val,f.x,f.y,'food',G.autoSim?'#00aacc':'#00cc88',11);
}

function eatBlob(b){
  // For auto-sim, only take positive-edge trades (nearly guaranteed win)
  const kelly=G.autoSim?.38:.25;
  const ef=Math.max(1,Math.abs(b.edge));
  const kf=kelly*Math.min(1,ef/12);
  const bet=Math.max(10,Math.round(G.balance*kf));

  // Auto-sim wins ~90% of the time on positive edges
  let wp=.50+b.edge/140;
  if(G.autoSim) wp=Math.min(.92,wp+.22); // very high win rate
  wp=Math.max(.3,Math.min(.94,wp));

  const won=Math.random()<wp;
  const pnl=won?Math.round(bet*.88):-Math.round(bet*.3); // small loss if any

  G.balance=Math.max(10,G.balance+pnl);
  G.pnl+=pnl;
  G.trades++;
  if(pnl>0){G.wins++;G.combo++;G.eaten++;}
  else{G.losses++;G.combo=0;} // no rekt count on auto-sim
  G.maxCombo=Math.max(G.maxCombo,G.combo);
  G.score+=Math.round(b.r*(pnl>0?3.5:.5));
  G.player.r=Math.min(140,G.player.r+(pnl>0?b.r*.14:b.r*.01));
  G.pnlHist.push(G.balance); G.maxBal=Math.max(G.maxBal,G.balance);
  if(pnl<0){G.hp=Math.max(0,G.hp-3);}else{G.hp=Math.min(100,G.hp+1);}
  updateHP();

  G.positions.unshift({market:b.mkt.n,side:b.side,bet,pnl,won,edge:b.edge});
  if(G.positions.length>10)G.positions.pop();

  addLog(G.autoSim?'BOT':'EAT',b.mkt.n,b.side,pnl,b.edge);
  updateUI(); updatePos(); drawChart(); updateStats(); updateEdge(b.mkt);

  if(pnl>0){
    pop('+$'+pnl,b.x,b.y,'big','#00ff88',30);
    burst(b.x,b.y,'#00ff88',16);
    shakeW();
    flash('rgba(0,255,136,0.05)');
    if(G.combo>=3) pop('ğŸ”¥ '+G.combo+'Ã—',b.x,b.y-b.r-18,'big','#ffd060',18);
  } else {
    pop('-$'+Math.abs(pnl),b.x,b.y,'big','#ff3355',22);
    flash('rgba(255,51,85,0.06)');
  }

  updateRound();
  setEl('r-eaten',G.eaten); setEl('r-rekt',G.rekt);
  setEl('t-combo',G.combo+'Ã—'); setEl('r-mc',G.maxCombo+'Ã—');
  setEl('h-combo',G.maxCombo);
  const cp=document.getElementById('hud-combo');
  if(G.combo>=2){cp.style.display='flex';setEl('combo-val',G.combo);}else cp.style.display='none';
}

function rektByBlob(b){
  G.rekt++;
  const loss=Math.round(G.balance*.14);
  G.balance=Math.max(10,G.balance-loss);
  G.pnl-=loss; G.losses++; G.trades++;
  G.hp=Math.max(0,G.hp-22); G.combo=0;
  G.player.r=Math.max(18,G.player.r*.76);
  G.player.vx*=-.25; G.player.vy*=-.25;
  G.pnlHist.push(G.balance);
  addLog('REKT',b.mkt.n,b.side,-loss,b.edge);
  updateUI(); drawChart(); updateHP(); updateStats();
  setEl('r-rekt',G.rekt);
  pop('REKT âˆ’$'+loss,G.player.x,G.player.y,'big','#ff3355',28);
  burst(G.player.x,G.player.y,'#ff3355',12);
  flash('rgba(255,51,85,0.1)');
  if(G.hp<=0)gameOver();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// POPUPS & PARTICLES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function w2s(wx,wy){const z=zoom();return{sx:(wx-G.camX)*z+VW/2,sy:(wy-G.camY)*z+VH/2};}

function pop(txt,wx,wy,cls,col,sz){
  const{sx,sy}=w2s(wx,wy);
  const el=document.createElement('div');
  el.className='pop '+cls;
  el.textContent=txt;
  el.style.cssText=`left:${sx}px;top:${sy}px;color:${col};font-size:${sz}px;text-shadow:0 2px 16px ${col}66,0 0 40px ${col}33;`;
  gw.appendChild(el);
  setTimeout(()=>el.remove(),cls==='big'?1250:780);
}

function burst(wx,wy,col,n){
  const{sx,sy}=w2s(wx,wy);
  for(let i=0;i<n;i++){
    const a=(i/n)*Math.PI*2+Math.random()*.5;
    const spd=50+Math.random()*80;
    const sz=3+Math.random()*5;
    const el=document.createElement('div');
    el.className='pt';
    el.style.cssText=`width:${sz}px;height:${sz}px;background:${col};left:${sx}px;top:${sy}px;box-shadow:0 0 6px ${col};`;
    gw.appendChild(el);
    el.animate([
      {transform:`translate(-50%,-50%) scale(1)`,opacity:1},
      {transform:`translate(calc(-50% + ${Math.cos(a)*spd}px),calc(-50% + ${Math.sin(a)*spd}px)) scale(0)`,opacity:0}
    ],{duration:450+Math.random()*250,easing:'ease-out',fill:'forwards'});
    setTimeout(()=>el.remove(),750);
  }
}

function shakeW(){
  gw.style.animation='none';void gw.offsetWidth;
  gw.style.animation='shakeW .22s ease';
  setTimeout(()=>gw.style.animation='',300);
}
function flash(col){
  const f=document.getElementById('flash');
  f.style.background=col;f.style.opacity='1';
  setTimeout(()=>f.style.opacity='0',90);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function render(){
  ctx.clearRect(0,0,VW,VH);
  if(!G.player)return;
  const z=zoom();
  ctx.save();
  ctx.translate(VW/2,VH/2); ctx.scale(z,z); ctx.translate(-G.camX,-G.camY);

  // Dark world bg
  ctx.fillStyle='#0a0e14'; ctx.fillRect(0,0,G.WORLD,G.WORLD);

  // Grid â€” cyan tint like screenshot 2
  ctx.strokeStyle='rgba(0,229,255,0.04)'; ctx.lineWidth=1/z;
  for(let x=0;x<=G.WORLD;x+=60){ctx.beginPath();ctx.moveTo(x,0);ctx.lineTo(x,G.WORLD);ctx.stroke();}
  for(let y=0;y<=G.WORLD;y+=60){ctx.beginPath();ctx.moveTo(0,y);ctx.lineTo(G.WORLD,y);ctx.stroke();}

  // World border glow
  ctx.strokeStyle='rgba(0,229,255,0.2)'; ctx.lineWidth=3/z;
  ctx.strokeRect(1/z,1/z,G.WORLD-2/z,G.WORLD-2/z);

  // Food
  for(const f of G.food){
    ctx.beginPath(); ctx.arc(f.x,f.y,f.r,0,Math.PI*2);
    ctx.fillStyle=f.color+'18'; ctx.fill();
    ctx.strokeStyle=f.color+'cc'; ctx.lineWidth=1/z; ctx.stroke();
    if(z>.5){
      ctx.fillStyle=f.color;
      ctx.font=`bold ${Math.max(5,6/z)}px 'Share Tech Mono',monospace`;
      ctx.textAlign='center'; ctx.textBaseline='middle';
      ctx.fillText('$'+f.val,f.x,f.y);
    }
  }

  // Sort blobs: small first
  const all=[...G.blobs,G.player].sort((a,b)=>a.r-b.r);
  for(const b of all) drawBlob(b,z);

  ctx.restore();
  drawMinimap(z);
}

function drawBlob(b,z){
  // outer glow
  const gcol=b.isPlayer?'rgba(26,136,255,0.2)':b.hostile?'rgba(204,34,68,0.15)':'rgba(0,204,102,0.15)';
  ctx.shadowColor=b.isPlayer?'#1a88ff':b.hostile?'#cc2244':'#00cc66';
  ctx.shadowBlur=18/z;

  // gradient body
  const grd=ctx.createRadialGradient(b.x-b.r*.28,b.y-b.r*.32,0,b.x,b.y,b.r);
  grd.addColorStop(0,lighten(b.color,.35));
  grd.addColorStop(.7,b.color);
  grd.addColorStop(1,darken(b.color,.25));
  ctx.beginPath(); ctx.arc(b.x,b.y,b.r,0,Math.PI*2);
  ctx.fillStyle=grd; ctx.fill();
  ctx.shadowBlur=0;

  // specular
  const hl=ctx.createRadialGradient(b.x-b.r*.3,b.y-b.r*.35,0,b.x-b.r*.1,b.y-b.r*.15,b.r*.55);
  hl.addColorStop(0,'rgba(255,255,255,0.45)');
  hl.addColorStop(1,'rgba(255,255,255,0)');
  ctx.beginPath(); ctx.arc(b.x,b.y,b.r,0,Math.PI*2); ctx.fillStyle=hl; ctx.fill();

  // border
  ctx.strokeStyle=darken(b.color,.3); ctx.lineWidth=Math.max(.8,1.8/z);
  ctx.beginPath(); ctx.arc(b.x,b.y,b.r,0,Math.PI*2); ctx.stroke();

  if(b.r*z<10)return;
  const fs=Math.max(7,Math.min(b.r*.36,13))/z;
  ctx.fillStyle='rgba(255,255,255,0.92)';
  ctx.font=`bold ${fs}px 'Share Tech Mono',monospace`;
  ctx.textAlign='center'; ctx.textBaseline='middle';
  if(b.isPlayer){
    ctx.fillText('YOU',b.x,b.y-fs*.5);
    ctx.font=`${fs*.68}px 'Share Tech Mono',monospace`;
    ctx.fillStyle='rgba(255,255,255,0.65)';
    ctx.fillText('$'+Math.round(G.balance/10)*10,b.x,b.y+fs*.6);
  } else {
    const lbl=b.mkt.n.length>7?b.mkt.n.slice(0,7):b.mkt.n;
    ctx.fillText(lbl,b.x,b.y-fs*.42);
    ctx.font=`${fs*.68}px 'Share Tech Mono',monospace`;
    ctx.fillStyle=b.edge>0?'rgba(0,255,136,.9)':'rgba(255,100,120,.9)';
    ctx.fillText((b.edge>0?'+':'')+b.edge+'% '+b.side,b.x,b.y+fs*.58);
  }
}

function drawMinimap(){
  const mm=76,mx=VW-mm-6,my=VH-mm-6;
  ctx.fillStyle='rgba(10,14,20,0.88)';
  ctx.strokeStyle='rgba(0,229,255,0.2)'; ctx.lineWidth=1;
  rr(ctx,mx,my,mm,mm,3); ctx.fill(); ctx.stroke();
  const sx=mm/G.WORLD,sy=mm/G.WORLD;
  for(const f of G.food){ctx.beginPath();ctx.arc(mx+f.x*sx,my+f.y*sy,1.2,0,Math.PI*2);ctx.fillStyle=f.color+'88';ctx.fill();}
  for(const b of G.blobs){ctx.beginPath();ctx.arc(mx+b.x*sx,my+b.y*sy,Math.max(1.5,b.r*sx*7),0,Math.PI*2);ctx.fillStyle=b.color+'bb';ctx.fill();}
  if(G.player){
    ctx.beginPath();ctx.arc(mx+G.player.x*sx,my+G.player.y*sy,4,0,Math.PI*2);
    ctx.fillStyle='#1a88ff';ctx.shadowColor='#1a88ff';ctx.shadowBlur=6;ctx.fill();ctx.shadowBlur=0;
    ctx.strokeStyle='rgba(255,255,255,0.5)';ctx.lineWidth=1;ctx.stroke();
  }
}

function rr(c,x,y,w,h,r){
  c.beginPath();c.moveTo(x+r,y);c.lineTo(x+w-r,y);c.arcTo(x+w,y,x+w,y+r,r);
  c.lineTo(x+w,y+h-r);c.arcTo(x+w,y+h,x+w-r,y+h,r);
  c.lineTo(x+r,y+h);c.arcTo(x,y+h,x,y+h-r,r);
  c.lineTo(x,y+r);c.arcTo(x,y,x+r,y,r);c.closePath();
}

function lighten(hex,a){const[r,g,b]=hx(hex);return `rgb(${Math.min(255,r+a*255|0)},${Math.min(255,g+a*255|0)},${Math.min(255,b+a*255|0)})`;}
function darken(hex,a){const[r,g,b]=hx(hex);return `rgb(${Math.max(0,r-a*255|0)},${Math.max(0,g-a*255|0)},${Math.max(0,b-a*255|0)})`;}
function hx(hex){return[parseInt(hex.slice(1,3),16),parseInt(hex.slice(3,5),16),parseInt(hex.slice(5,7),16)];}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CHART
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function drawChart(){
  const c=document.getElementById('pnl-cv');
  const tc=document.getElementById('top-c');
  const w=tc.clientWidth-24, h=148;
  c.width=w; c.height=h;
  const ct=c.getContext('2d');
  const data=G.pnlHist;
  if(data.length<2)return;
  ct.clearRect(0,0,w,h);

  const mn=Math.min(...data)*.997, mx=Math.max(...data)*1.003;
  const rng=mx-mn||1;
  const pts=data.map((v,i)=>({x:(i/(data.length-1))*(w-2)+1,y:h-4-((v-mn)/rng)*(h-9)}));

  // Baseline
  const bl=h-4-((G.start$-mn)/rng)*(h-9);
  ct.save();ct.strokeStyle='rgba(255,255,255,0.06)';ct.setLineDash([5,5]);
  ct.beginPath();ct.moveTo(0,bl);ct.lineTo(w,bl);ct.stroke();ct.setLineDash([]);ct.restore();

  const pos=G.balance>=G.start$;
  const col=pos?'#00ff88':'#ff3355';

  // Area fill
  const grd=ct.createLinearGradient(0,0,0,h);
  grd.addColorStop(0,pos?'rgba(0,255,136,.3)':'rgba(255,51,85,.25)');
  grd.addColorStop(1,'rgba(0,0,0,0)');
  ct.beginPath();ct.moveTo(pts[0].x,h);
  pts.forEach(p=>ct.lineTo(p.x,p.y));
  ct.lineTo(pts[pts.length-1].x,h);ct.closePath();
  ct.fillStyle=grd;ct.fill();

  // Line with glow
  ct.shadowColor=col;ct.shadowBlur=6;
  ct.beginPath();pts.forEach((p,i)=>i===0?ct.moveTo(p.x,p.y):ct.lineTo(p.x,p.y));
  ct.strokeStyle=col;ct.lineWidth=2;ct.stroke();ct.shadowBlur=0;

  // Trade dots
  if(data.length<100){
    pts.forEach((p,i)=>{
      if(!i)return;
      const df=data[i]-data[i-1];
      ct.beginPath();ct.arc(p.x,p.y,df>5?3.5:2,0,Math.PI*2);
      ct.fillStyle=df>=0?'#00ff88':'#ff3355';
      ct.shadowColor=df>=0?'#00ff88':'#ff3355';ct.shadowBlur=df>5?8:3;
      ct.fill();ct.shadowBlur=0;
    });
  }

  // Current dot pulse
  const lp=pts[pts.length-1];
  ct.beginPath();ct.arc(lp.x,lp.y,5,0,Math.PI*2);
  ct.fillStyle=col;ct.shadowColor=col;ct.shadowBlur=14;ct.fill();ct.shadowBlur=0;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UI UPDATES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setEl(id,v){const e=document.getElementById(id);if(e)e.textContent=v;}
function pulse(id){const e=document.getElementById(id);if(!e)return;e.classList.remove('spulse');void e.offsetWidth;e.classList.add('spulse');setTimeout(()=>e.classList.remove('spulse'),350);}

function updateHP(){
  const hp=Math.round(G.hp);
  document.getElementById('hp-fill').style.width=hp+'%';
  setEl('hp-val',hp);
}
function updateUI(){
  const ps=(G.pnl>=0?'+$':'-$')+Math.abs(G.pnl).toLocaleString();
  const wr=G.trades>0?((G.wins/G.trades)*100).toFixed(1)+'%':'â€”';
  const apt=G.trades>0?(G.pnl>=0?'+$':'-$')+(Math.abs(G.pnl)/G.trades).toFixed(1):'â€”';
  const bs='$'+G.balance.toLocaleString();
  const dd=G.maxBal>G.start$?(((G.maxBal-G.balance)/G.maxBal)*100).toFixed(1):'0.0';

  ['r-bal','t-bal','chart-bal'].forEach(id=>setEl(id,bs));
  document.getElementById('r-bal').style.color=G.pnl>=0?'var(--green)':'var(--red)';
  document.getElementById('chart-bal').style.color=G.pnl>=0?'var(--green)':'var(--red)';
  const rp=document.getElementById('r-pnl');rp.textContent=ps;rp.style.color=G.pnl>=0?'var(--green)':'var(--red)';
  const tp=document.getElementById('t-pnl');tp.textContent=ps;tp.className=G.pnl>=0?'g':'r';
  const cp=document.getElementById('chart-pnl');cp.textContent=ps;cp.style.color=G.pnl>=0?'var(--green)':'var(--red)';
  ['r-wr','t-wr','chart-wr'].forEach(id=>setEl(id,wr));
  setEl('r-tr',G.trades);setEl('chart-tr',G.trades);
  setEl('r-apt',apt);document.getElementById('r-apt').style.color=G.pnl>=0?'var(--green)':'var(--red)';
  setEl('chart-apt',apt);document.getElementById('chart-apt').style.color=G.pnl>=0?'var(--green)':'var(--red)';
  setEl('chart-dd','-'+dd+'%');
  setEl('r-sc',G.score);setEl('score-val',G.score);
  if(G.player)setEl('r-size',G.player.r.toFixed(0)+'u');
  pulse('r-bal');pulse('chart-bal');
}
function updateStats(){
  const tot=G.eaten+G.rekt;
  if(tot>0){const acc=G.eaten/tot*100;setEl('acc-v',acc.toFixed(0)+'%');document.getElementById('acc-f').style.width=acc+'%';}
  setEl('h-eat',G.eaten);setEl('h-rekt',G.rekt);setEl('h-food',G.foodEaten);
}
function updateRound(){
  const d=Math.min(G.trades,20);
  setEl('round-val',d+'/20');
  document.getElementById('round-fill').style.width=(d/20*100)+'%';
}
function updatePos(){
  const el=document.getElementById('pos-list');el.innerHTML='';
  G.positions.slice(0,7).forEach(p=>{
    const ps=(p.pnl>=0?'+$':'-$')+Math.abs(p.pnl);
    const bw=Math.min(100,Math.abs(p.pnl)/p.bet*100);
    const d=document.createElement('div');
    d.className='pc '+(p.won?'win':'loss');
    d.innerHTML=`<div class="pc-h"><span class="pc-m">${p.market} ${p.side}</span><span class="pc-p ${p.pnl>=0?'pos':'neg'}">${ps}</span></div><div class="pc-bar"><div class="pc-bf ${p.pnl>=0?'pos':'neg'}" style="width:${bw}%"></div></div><div class="pc-meta"><span>bet $${p.bet}</span><span>edge ${(p.edge>0?'+':'')+p.edge}%</span></div>`;
    el.appendChild(d);
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LOG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function addLog(action,mkt,side,pnl,edge){
  const n=new Date();
  const t=[n.getHours(),n.getMinutes(),n.getSeconds()].map(x=>String(x).padStart(2,'0')).join(':');
  const ps=pnl>=0?'+$'+pnl:'-$'+Math.abs(pnl);
  const pc=pnl>=0?'pos':'neg';
  const ac=action==='EAT'?'eat':action==='BOT'?'win':action==='FOOD'?'food':'skip';
  const es=(edge>0?'+':'')+edge+'%';
  G.logLines.unshift(`<div class="ll"><span class="lt">${t}</span><span class="la ${ac}">${action}</span><span class="lm">${mkt} ${side}</span><span class="le">edge:${es}</span><span class="lp ${pc}">${ps}</span></div>`);
  if(G.logLines.length>8)G.logLines.pop();
  setEl('log-c',G.logLines.join(''));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MARKET LIST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildMkts(){
  const el=document.getElementById('mkt-list');el.innerHTML='';
  MKTS.forEach(m=>{
    const e=(Math.random()*14-7).toFixed(1);
    const d=document.createElement('div');
    d.className='mi'+(m===activeMkt?' act':'');
    d.innerHTML=`<span class="mn">${m.n}</span><span class="my">${m.y.toFixed(0)}Â¢</span><span class="mno">${(100-m.y).toFixed(0)}Â¢</span><span class="me ${parseFloat(e)>=0?'pos':'neg'}">${e}%</span>`;
    d.onclick=()=>{activeMkt=m;buildMkts();updateEdge(m);};
    el.appendChild(d);
  });
}
function updateEdge(m){
  const fair=50+(Math.random()*8-4);
  const mkt=m.y+(Math.random()*3-1.5);
  const dv=fair-mkt;
  setEl('model-fair',fair.toFixed(2)+'%');
  setEl('mkt-price',mkt.toFixed(2)+'%');
  const de=document.getElementById('divergence');
  de.textContent=(dv>=0?'+':'')+dv.toFixed(2)+'%';
  de.style.color=Math.abs(dv)>3?'var(--green)':'var(--red)';
  setEl('bs-d2',(Math.random()*.005-.0025).toFixed(4));
  setEl('bs-nd2',(.48+Math.random()*.04).toFixed(5));
  setEl('bs-vol',(.30+Math.random()*.12).toFixed(3));
  setEl('bs-lam',(2.4+Math.random()*1.2).toFixed(2));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TIMER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function startTimer(){
  G.roundTimer=300;tickT();
  G.timerInt=setInterval(()=>{G.roundTimer--;tickT();if(G.roundTimer<=0){clearInterval(G.timerInt);roundComplete();}},1000);
}
function tickT(){
  const m=Math.floor(G.roundTimer/60),s=G.roundTimer%60;
  setEl('timer-val',m+':'+String(s).padStart(2,'0'));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GAME FLOW
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function startGame(sim){
  G.autoSim=sim;
  document.getElementById('overlay').style.display='none';
  document.getElementById('sim-btn').className=sim?'on':'';
  document.getElementById('sim-btn').textContent=sim?'â–  AUTO SIM ON':'â¬› AUTO SIM';

  Object.assign(G,{
    running:true,score:0,combo:0,maxCombo:0,
    hp:100,balance:1000,start$:1000,pnl:0,
    wins:0,losses:0,trades:0,eaten:0,rekt:0,foodEaten:0,
    pnlHist:[1000],maxBal:1000,
    positions:[],logLines:[],accum:0,
  });

  initWorld();
  updateHP();updateUI();updatePos();updateStats();
  clearInterval(G.timerInt);startTimer();
  drawChart();buildMkts();

  if(!G.btcGo){G.btcGo=true;startBTC();}
  if(!G.feedGo){G.feedGo=true;startFeed();}
}

function toggleSim(){
  if(!G.running)return;
  G.autoSim=!G.autoSim;
  document.getElementById('sim-btn').className=G.autoSim?'on':'';
  document.getElementById('sim-btn').textContent=G.autoSim?'â–  AUTO SIM ON':'â¬› AUTO SIM';
}

function roundComplete(){if(!G.running)return;G.running=false;showGrade();}
function gameOver(){G.running=false;clearInterval(G.timerInt);showGrade();}

function showGrade(){
  const tot=G.eaten+G.rekt;
  const acc=tot>0?G.eaten/tot*100:50;
  const grade=acc>=80&&G.pnl>0?'S':acc>=65?'A':acc>=50?'B':acc>=35?'C':'F';
  const gc={S:'#00ff88',A:'#00e5ff',B:'#ffd060',C:'#aa55ff',F:'#ff3355'}[grade];
  const el=document.getElementById('grade-el');
  el.textContent=grade;el.style.color=gc;el.style.textShadow=`0 0 50px ${gc}`;el.style.opacity='.85';
  setTimeout(()=>{el.style.opacity='0';showResult(grade,gc);},1800);
}

function showResult(grade,gc){
  const ov=document.getElementById('overlay');ov.style.display='flex';
  const ps=(G.pnl>=0?'+$':'-$')+Math.abs(G.pnl).toLocaleString();
  const wr=G.trades>0?((G.wins/G.trades)*100).toFixed(1)+'%':'â€”';
  ov.innerHTML=`
    <div style="font-family:'Orbitron',monospace;font-size:80px;font-weight:900;color:${gc};text-shadow:0 0 50px ${gc};line-height:1;margin-bottom:8px">${grade}</div>
    <div style="font-family:'Orbitron',monospace;font-size:14px;color:var(--white);letter-spacing:4px;margin-bottom:14px">ROUND COMPLETE</div>
    <div class="ov-box" style="display:grid;grid-template-columns:auto auto;gap:5px 36px;text-align:left">
      <span style="color:var(--text)">SCORE</span><b style="color:var(--gold)">${G.score.toLocaleString()}</b>
      <span style="color:var(--text)">P&L</span><b style="color:${G.pnl>=0?'var(--green)':'var(--red)'}">${ps}</b>
      <span style="color:var(--text)">WIN RATE</span><b style="color:var(--cyan)">${wr}</b>
      <span style="color:var(--text)">EATEN</span><b style="color:var(--green)">${G.eaten}</b>
      <span style="color:var(--text)">REKT</span><b style="color:var(--red)">${G.rekt}</b>
      <span style="color:var(--text)">TRADES</span><b style="color:var(--bright)">${G.trades}</b>
    </div>
    <div class="ov-btns">
      <button class="ovb p" onclick="startGame(false)">â–¶ PLAY</button>
      <button class="ovb s" onclick="startGame(true)">âš¡ AUTO SIM</button>
    </div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BTC + FEED
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function startBTC(){
  setInterval(()=>{
    G.btcPrice+=Math.random()*50-25;G.btcPrice=Math.max(60000,Math.min(65500,G.btcPrice));
    MKTS.forEach(m=>{m.y=Math.max(10,Math.min(90,m.y+(Math.random()*4-2)));});
    buildMkts();updateEdge(activeMkt);
  },1700);
}
const FEED=[
  ()=>`SCAN ${rm()} dâ‚=${r4()} N(dâ‚)=${r2()} lag:${rms()}`,
  ()=>`PRICE ${rm()} Ïƒ_imp=${r3()} Vanna=${r2()}`,
  ()=>`ARBS ${rm()} edge=${(Math.random()*10-5).toFixed(2)}% spread=${(95+Math.random()*5).toFixed(0)}Â¢`,
  ()=>`MC 200K dt=${r4()} BTC_fair=${(G.btcPrice*(1+Math.random()*.001-.0005)).toFixed(0)}`,
  ()=>`BOOK ${rm()} bid=${rp()}Â¢ ask=${rp()}Â¢ imb=${(.35+Math.random()*.3).toFixed(2)}`,
  ()=>`KELLY ${rm()} f*=${(.1+Math.random()*.3).toFixed(3)} edge=${(Math.random()*12-6).toFixed(2)}%`,
];
function rm(){return MKTS[Math.floor(Math.random()*MKTS.length)].n;}
function r4(){return(Math.random()*.005-.0025).toFixed(4);}
function r3(){return(.3+Math.random()*.15).toFixed(3);}
function r2(){return(.4+Math.random()*.2).toFixed(4);}
function rms(){return Math.floor(Math.random()*400+50)+'ms';}
function rp(){return Math.floor(Math.random()*20+40);}

function startFeed(){
  setInterval(()=>{
    G.feedLines.unshift(FEED[Math.floor(Math.random()*FEED.length)]());
    if(G.feedLines.length>5)G.feedLines.pop();
    setEl('live-feed',G.feedLines.join('<br>'));
  },660);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BOOT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
buildMkts();updateEdge(activeMkt);drawChart();
startFeed();startBTC();
initWorld();
requestAnimationFrame(loop);
</script>
</body>
</html>
